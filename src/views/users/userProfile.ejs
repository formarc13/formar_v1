<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head')%>
  <body>
    <%- include('../partials/header')%>
    <main class="userProfile mt-5">
      <div class="avatar">
        <img src="/images/avatar/<%= user.avatar %>" alt="" />
      </div>
      <div class="container">
        <div class="row p-5">
          <h3 class="text-center mt-3 mb-3">Datos personales</h3>
          <div class="col-md-6 d-flex flex-column align-items-center justify-content-evenly ">
            <p>Nombre: <%= user.name %></p>
            <p>Email: <%= user.email %></p>
            <p>Teléfono: <%= user.phone ? user.phone : "------" %></p>
          </div>
          <div class="col-md-6">
            <form action="/usuarios/perfil?_method=PUT" method="POST">
              <div class="mb-3">
                <label for="name" class="form-label">Nombre</label>
                <input
                  type="text"
                  class="form-control"
                  name="name"
                  id="name"
                  value="<%= locals.old && old.name %>"
                />
                <% if (locals.errors && errors.name) { %>
                <small class="text-danger"><%= errors.name.msg %></small>
                <% } %>
              </div>
              <div class="mb-3">
                <label for="phone" class="form-label">Teléfono</label>
                <input
                  type="text"
                  class="form-control"
                  name="phone"
                  id="phone"
                  value="<%= locals.old && old.phone %>"
                />
                <% if (locals.errors && errors.phone) { %>
                <small class="text-danger"><%= errors.phone.msg %></small>
                <% } %>
              </div>
              <button class="btn btn-outline-success" type="submit">
                Editar datos
              </button>
            </form>
          </div>
        </div>
        <div class="container p-5 border rounded">
          <h4 class="text-center mt-3 mb-3">Gestionar direcciones</h4>

          <form action="/usuarios/direcciones" class="row" method="post">
            <div class="mb-3 col-md-6">
              <label for="street" class="form-label">Calle</label>
              <input
                type="text"
                class="form-control"
                name="street"
                id="street"
                value="<%= locals.old && old.street %>"
              />
              <% if (locals.errors && errors.street) { %>
              <small class="text-danger"><%= errors.street.msg %></small>
              <% } %>
            </div>
            <div class="mb-3 col-md-6" class="form-group">
              <label for="number" class="form-label">Número</label>
              <input
                type="text"
                class="form-control"
                name="number"
                id="number"
                value="<%= locals.old && old.number %>"
              />
              <% if (locals.errors && errors.number) { %>
              <small class="text-danger"><%= errors.number.msg %></small>
              <% } %>
            </div>
            <div class="mb-3 col-md-6">
              <select class="form-select" name="province">
                <option value="" hidden selected>Provincia</option>
              </select>
              <% if (locals.errors && errors.province) { %>
              <small class="text-danger"><%= errors.province.msg %></small>
              <% } %>
            </div>
            <div class="mb-3 col-md-6">
              <select class="form-select" name="city">
                <option value="" hidden selected>Ciudad</option>
              </select>
              <% if (locals.errors && errors.city) { %>
              <small class="text-danger"><%= errors.city.msg %></small>
              <% } %>
            </div>
            <div class="mb-3 d-flex justify-content-center">
              <button class="btn btn-outline-primary" type="submit">
                Agregar
              </button>
            </div>
          </form>
          <% if (user.addresses.length > 0) { %>
          <div class="table-responsive p-5 border rounded">
            <table class="table table-hover">
              <thead>Mis direcciones</thead>
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Calle</th>
                  <th scope="col">Número</th>
                  <th scope="col">Provincia</th>
                  <th scope="col">Ciudad</th>
                  <th scope="col">Eliminar</th>
                </tr>
              </thead>
              <tbody>
                <% user.addresses.forEach(address => { %>
                <tr>
                  <th scope="row"><%- address.id %></th>
                  <td><%- address.street %></td>
                  <td><%- address.number %></td>
                  <td><%- address.province %></td>
                  <td><%- address.city %></td>
                  <td>
                    <form
                      action="/usuarios/direcciones/<%- address.id %>?_method=DELETE"
                      method="POST"
                    >
                      <button class="btn btn-outline-danger" type="submit">
                        Eliminar
                      </button>
                    </form>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>

          <% } %>
        </div>
      </div>
    </main>
    <%- include('../partials/footer')%>
  </body>
</html>
